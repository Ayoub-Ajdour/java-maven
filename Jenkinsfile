pipeline {
    agent any
  
    tools {
        maven "M3"  // Specify the Maven installation configured in Jenkins
    }

    environment {
        GIT_CREDENTIALS_ID = 'your-git-credentials-id'
             JENKINS_URL = 'http://192.168.189.133:8080'
    
    }

    stages {
        stage('Checkout') {
            steps {
                git(
                    url: 'https://github.com/Ayoub-Ajdour/java-maven.git',
                    credentialsId: env.GIT_CREDENTIALS_ID,
                    branch: 'main'  // Adjust the branch if necessary
                )
            }
        }

        stage('List Files') {
            steps {
                sh 'ls -la'
                sh 'ls -la maven'
            }
        }

        stage('Build') {
            steps {
                script {
                    dir('maven') {
                        // Run Maven commands
                        sh 'mvn clean test package'
                        sh "java -jar target/maven-0.0.1-SNAPSHOT.jar"
                    }
                }
            }

           
        }
        stage('Archive') {
            steps {
                // Archive the JAR files generated by Maven
                archiveArtifacts artifacts: 'maven/target/*.jar', fingerprint: true
            }
        }
          stage('Notify Slack'){
            steps {
                script {
                    def artifactPath = "maven/target/maven-0.0.1-SNAPSHOT.jar"
                    def artifactURL = "${env.JENKINS_URL}/job/${env.JOB_NAME}/${env.BUILD_NUMBER}/artifact/${artifactPath}"

                    //Add channel name
                    slackSend channel: 'test',
                    message: "Un nouveau build Java est disponible: ---> Resultat: ${currentBuild.currentResult}, Job: ${env.JOB_NAME}, Build: ${env.BUILD_NUMBER} \n <${artifactURL}|Cliquer ici pour télécharger>"
                }
            }
 }
    }
}
